<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>SPECIAL study</title>
    <script type='text/javascript' src='//code.jquery.com/jquery-1.9.1.js'></script>
    <script type='text/javascript' src="http://knockoutjs.com/downloads/knockout-3.0.0.js"></script>
    <script type='text/javascript' src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      @media (min-width: 30em) {
        /* Show the table header rows and set all cells to display: table-cell */
        #ggcindications td,
        #ggcindications th,
        #ggcindications tbody th,
        #ggcindications tbody td,
        #ggcindications thead td,
        #ggcindications thead th {
          border: 1px solid #000;
          display: table-cell;
          margin: 0;
        }
        /* Hide the labels in each cell */
        #ggcindications td .ui-table-cell-label,
        #ggcindications th .ui-table-cell-label {
          display: none;
        }
        #ggcindications td {
          text-align: center;
        }
        #ggcindications td:first-child {
          text-align: left;
        }
      }
      body {
        font-size: 1.2em;
      }
      a,
      input,
      select,
      .ui-btn {
        font-size: 0.9em !important;
      }
      .ui-btn {
        background: #ddf !important;
      }
      .even .ui-btn {
        background: #e5e5ff !important;
      }
      @media (min-width: 780px) {
        body {
          font-size: 1.6em;
        }
      }
      
      .ui-collapsible-heading-toggle {
        overflow: visible;
        white-space: normal;
      }
      .centered {
        max-width: 1024px;
        margin: auto;
      }
      #ggcindications tr,
      #ggcindications th {
        border: 1px solid #000;
      }
      .special {
        text-decoration: underline;
        font-weight: bold;
      }
      .completed {
        border: none !important;
        border-bottom: 1px solid #ddd !important;
        background: none !important;
      }
      .statement {
        border: 1px #ddd solid;
        border-radius: 5px;
        background: #fff;
        padding: 5px;
        padding-bottom: 0px;
        margin: 5px;
        text-align: center;
      }
      #progressbar {
        font-weight: bold;
        padding: 2px;
        margin: 0px;
        background: #7c7;
        white-space: nowrap;
        text-align: center;
        line-height: 1em;
        font-size: 0.8em;
      }
      .ui-content {
        padding-top: 0em !important;
        padding-bottom: 1em !important;
        padding-left: 1em !important;
        padding-right: 1em !important;
      }
      .ui-page {
        padding: 0px !important;
        background: #EEF;
        font-size: 0.9em;
      }
      .highlight {
        background-color: yellow;
      }
      .smallc {
        margin: 0px;
        font-weight: bold;
      }
      .positive {
        background: #afa !important;
        box-shadow: 0px 2px 2px #ccc;
        border: 1px #555 solid !important;
        text-shadow: none !important;
        color: black !important;
      }
      p {
        font-size: 1.1em;
        line-height: 1.5em;
      }
    </style>
  </head>

  <body>
    <div data-role="page" id="front">
      <div data-role="main" id="maincontainer" class="ui-content centered">
        <div id="questionContainer">
          <div data-bind="visible: section() == -1">
            <p style="font-size: 1.3em; padding-top: 0; text-shadow: 3px 3px 3px #fff">
              <span class="special">S</span>topping and
              <span class="special">P</span>reventing
              <span class="special">E</span>rrors in
              <span class="special">C</span>MV-negative and
              <span class="special">I</span>rradiated blood transfusions through
              <span class="special">A</span>pp-based
              <span class="special">L</span>earning <b>(SPECIAL)</b>.</p>
            <p>We would like to invite you to participate in the SPECIAL study. Before you decide whether to take part, click on the headings below to find out why we need your help and what we will ask you to do.</p>
            <div data-role="collapsibleset" data-inset="true">
              <div data-role="collapsible" data-collapsed="true">
                <h3>1. What is the aim of the research?</h3>
                 <center>
                  <img src="UoE_logo.gif" style="margin: 3%; margin-bottom: 0; width: 93%; max-width: 531px;">
                </center>
                <p>Blood transfusion is a complex process and about one hundred mistakes related to the provision of irradiated and Cytomegalovirus (CMV) negative blood ("special blood components") are reported every year to Serious Hazards of Transfusion (SHOT) in the UK.</p>
                <p>Researchers at the University of Edinburgh are collaborating with experts in transfusion to create an app with learning materials about special blood components for staff involved in key stages of the transfusion process. This pilot study will evaluate whether the app increases knowledge of the correct use of special blood components.</p>
              </div>
              <div data-role="collapsible" data-collapsed="true" class="even">
                <h3>2. What will I be asked to do?</h3>
                <p>We are asking you to answer a short multiple choice test about special blood components. Answering the questions should take you about 15 minutes. You can choose to participate at a time and from a location that is convenient to you. You will need access to a computer with an Internet connection.</p>
              </div>
              <div data-role="collapsible" data-collapsed="true">
                <h3>3. Why should I participate?</h3>
                <p>By taking part, you will help shape the design of a new learning resource. If results are positive, wider dissemination of the app could reduce mistakes and enhance patient safety. Taking part in the study is also an excellent opportunity to test your knowledge in a safe environment. Additionally, there is a chance to win a &pound;50 national book token voucher. Participation is completely voluntary and there are no risks to participating.</p>
              </div>
              <div data-role="collapsible" data-collapsed="true" class="even">
                <h3>4. How will you use my data?</h3>
                <p>Any data that you provide will be treated confidentially and your answers will be reported anonymously in publications. The information will be held securely for the duration of the research project (3 years) and then destroyed.</p>
              </div>
              <div data-role="collapsible" data-collapsed="true">
                <h3>5. Who are you asking to participate?</h3>
                <p>We are inviting all grades of doctors, registered nurses, midwives and transfusion laboratory staff who recently completed Module 1 of the Learn Blood Transfusion e-learning programme from three NHS Lothian hospitals:</p>
                <ul>
                  <li>The Royal Infirmary of Edinburgh</li>
                  <li>Western General Hospital</li>
                  <li>St John's Hospital.</li>
                </ul>
                <p style="display: none">Staff who do not meet these criteria are excluded from participating. If you have received a personal email invitation from the research team you are likely to be eligible.</p>
              </div>
              <div data-role="collapsible" data-collapsed="true" class="even">
                <h3>6. Who is conducting the research?</h3>
                <p>The research is conducted by Mr. Karl Monsen, a PhD candidate at The University of Edinburgh, in collaboration with Ms. Susan Cottrell, Better Blood Transfusion Nurse Specialist in Education at The Scottish National Blood Transfusion Service.</p>
                <p>Dr. Brian McClelland is medical adviser to the project and the study is supported by Dr. Alastair Nimmo, Chair of the NHS Lothian Transfusion Committee.</p>
                <p>If you have any questions, please contact Karl at the following email address: <a href="mailto: k.d.monsen@sms.ed.ac.uk">k.d.monsen@sms.ed.ac.uk</a>.</p>
                <p>Alternatively, you can write to: Karl Monsen, Centre for Design Informatics, Room 3.10, Evolution House, 78 West Port, Edinburgh, EH1 2L.</p>
                <p>Thank you for your time.</p>
              </div>
              <h2>Ready to begin?</h2>
              <p>By proceeding you indicate that you have read the above information and freely consent to take part in the study.</p>
              <a href="#" class="positive" data-role="button" data-icon="check" data-bind="click: $root.nextSection">I agree to participate</a>
            </div>
          </div>
          <div data-bind="visible: section() == 0">
            <h2>Confirm eligibility</h2>
            <p>Please answer the questions to confirm that you are eligible to participate in the study.</p>
            <h3>1. At what hospital are you based?</h3>
            <select data-bind="value: hospital">
              <option value="" selected>Please select</option>
              <option value="rie">Royal Infirmary of Edinburgh</option>
              <option value="sjh">St John's Hospital</option>
              <option value="wgh">Western General Hospital</option>
              <option value="other">None of the above</option>
            </select>
            <div data-bind="visible: hospital() !== ''">
              <div data-bind="visible: hospital() == 'other'">
                <h2 style="color: #A00">Ineligible</h2>
                <p>Sorry, only staff working at the hospitals listed above are eligible to participate in this study. If you recently moved hospital, please select your previous hospital.</p>
              </div>
              <div data-bind="visible: hospital() !== 'other'">
                <h3>2. What is your role?</h3>
                <select data-bind="value: position">
                  <option value="">Please select</option>
                  <option value="bb">Blood Bank/Hospital Laboratory staff</option>
                  <option value="dr">Doctor</option>
                  <option value="mw">Midwife</option>
                  <option value="odp">Operating Department Practitioner</option>
                  <option value="rn">Registered Nurse</option>
                  <option value="ot">Other</option>
                </select>
                <div data-bind="visible: position() !== ''" style="margin-left: 2em;">
                  <div data-bind="visible: (position() == 'ot' || position() == 'bb')">
                    <h3>Please enter your job title:</h3>
                    <input data-bind="value: otherposition, valueUpdate: 'keyup'">
                  </div>
                  <div data-bind="visible: position() == 'dr'">
                    <h3>What is your grade?</h3>
                    <select data-bind="value: grade">
                      <option value="">Please select</option>
                      <option value="fy1">Foundation year 1</option>
                      <option value="fy2">Foundation year 2</option>
                      <option value="registrar">Registrar</option>
                      <option value="consultant">Consultant</option>
                    </select>
                  </div>
                  <div data-bind="visible: (position() !== '' && position() !== 'dr' && position() !== 'ot' && position() !== 'bb') || (position() !== '' && (grade() !== '' || otherposition() !== ''))">
                    <h3>How many years of experience do you have?</h3>
                    <select data-bind="value: experience">
                      <option value="-1">Please select</option>
                      <option value="0">Less than one year</option>
                      <option value="1">1 year</option>
                      <option value="2">2 years</option>
                      <option value="3">3 years</option>
                      <option value="4">4 years</option>
                      <option value="5">5 years</option>
                      <option value="6">6 years</option>
                      <option value="6">7 years</option>
                      <option value="6">8 years</option>
                      <option value="6">9 years</option>
                      <option value="10">10 years</option>
                      <option value="11">11 years</option>
                      <option value="12">12 years</option>
                      <option value="13">13 years</option>
                      <option value="14">14 years</option>
                      <option value="15">15 years</option>
                      <option value="16">16 years</option>
                      <option value="17">17 years</option>
                      <option value="18">18 years</option>
                      <option value="19">19 years</option>
                      <option value="20">20 years</option>
                      <option value="21">21 years</option>
                      <option value="22">22 years</option>
                      <option value="23">23 years</option>
                      <option value="24">24 years</option>
                      <option value="25">25 years</option>
                      <option value="26">26 years</option>
                      <option value="27">27 years</option>
                      <option value="28">28 years</option>
                      <option value="29">29 years</option>
                      <option value="30">30 years</option>
                      <option value="31">31 years</option>
                      <option value="32">32 years</option>
                      <option value="33">33 years</option>
                      <option value="34">34 years</option>
                      <option value="35">35 years</option>
                      <option value="36">36 years</option>
                      <option value="37">37 years</option>
                      <option value="38">38 years</option>
                      <option value="39">39 years</option>
                      <option value="40">40 years</option>
                      <option value="41">More than 40 years</option>
                      <option value="42">Don't know</option>
                    </select>
                  </div>
                  <div data-bind="visible: experience() > -1">
                    <h3>What is your specialty?</h3>
                    <select data-bind="value: specialty">
                      <option value="">Please select</option>
                      <option value="ae">Accident and emergency (A&amp;E)</option>
                      <option value="an">Anaesthetics</option>
                      <option value="bb">Blood bank</option>
                      <option value="ca">Cardiology</option>
                      <option value="cc">Critical care</option>
                      <option value="ga">Gastroenterology</option>
                      <option value="gp">General practitioner</option>
                      <option value="ge">Geriatrics</option>
                      <option value="he">Haematology</option>
                      <option value="ne">Neonatology</option>
                      <option value="na">None / Not applicable</option>
                      <option value="ob">Obstetrics or gynaecology</option>
                      <option value="on">Oncology</option>
                      <option value="or">Orthopaedics</option>
                      <option value="pd">Paediatrics</option>
                      <option value="su">Surgical</option>
                      <option value="th">Theatre</option>
                      <option value="ot">Other</option>
                      <option value="dk">Don't know</option>
                    </select>
                  </div>
                  <div data-bind="visible: specialty() == 'ot'">
                    <h3>Please enter your specialty:</h3>
                    <input data-bind="value: otherspecialty">
                  </div>
                </div>
                <div data-bind="visible: specialty() !== '' && position() !== ''">
                  <h3>3. Do your current place of work have patients who require CMV-negative or irradiated blood components?</h3>
                  <select data-bind="value: currentwork">
                    <option value="-1">Please select</option>
                    <option value="0">No</option>
                    <option value="1">Yes</option>
                    <option value="2">Don't know</option>
                  </select>
                  <div data-bind="visible: currentwork() !== '-1'" style="margin-left: 2em;">
                    <div data-bind="visible: currentwork() == '1'">
                      <h3>How long have you been with your current workplace?</h3>
                      <select data-bind="value: currentexperience">
                        <option value="-1">Please select</option>
                        <option value="1">Less than 1 month</option>
                        <option value="2">1-3 months</option>
                        <option value="3">4-6 months</option>
                        <option value="4">7-12 months</option>
                        <option value="5">13-24 months</option>
                        <option value="6">25-36 months</option>
                        <option value="7">More than 36 months</option>
                        <option value="0">Don't know</option>
                      </select>
                    </div>
                    <div data-bind="visible: currentexperience() == '0' || currentwork() == '0' || currentwork() == '2'">
                      <h3>Have you <i>previously</i> been part of a workplace with patients who require CMV-negative or irradiated blood components?</h3>
                      <select data-bind="value: pastwork">
                        <option value="-1">Please select</option>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                        <option value="2">Don't know</option>
                      </select>
                      <div data-bind="visible: pastwork() !== '-1'" style="margin-left: 2em;">
                        <div data-bind="visible: pastwork() == '1'">
                          <h3>How long did you work there?</h3>
                          <select data-bind="value: pastexperience">
                            <option value="-1">Please select</option>
                            <option value="1">Less than 1 month</option>
                            <option value="2">1-3 months</option>
                            <option value="3">4-6 months</option>
                            <option value="4">7-12 months</option>
                            <option value="5">13-24 months</option>
                            <option value="6">25-36 months</option>
                            <option value="7">More than 36 months</option>
                            <option value="0">Don't know</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div data-bind="visible: (currentwork() !== '-1' && (pastexperience() > -1 || currentexperience() > -1)) || pastwork() == '0' || pastwork() == '2'">
                    <h3>4. In your current role, how often do you work with patients who require CMV-negative or irradiated blood components?</h3>
                    <select data-bind="value: frequency">
                      <option value="-1">Please select</option>
                      <option value="10">Every day</option>
                      <option value="9">Every other day</option>
                      <option value="8">Every week</option>
                      <option value="7">Every other week</option>
                      <option value="6">Every month</option>
                      <option value="5">Every other month</option>
                      <option value="4">Every quarter</option>
                      <option value="3">Every six months</option>
                      <option value="2">Less frequently</option>
                      <option value="1">Never</option>
                      <option value="0">Don't know</option>
                    </select>
                    <div data-bind="visible: frequency() > -1">
                      <h3>Thank you. You are eligible to participate in the study.</h3>
                      <p>Press the green button to start the knowledge test.</p> <a href="#" data-icon="carat-r" data-iconpos="right" class="positive" data-role="button" data-bind="click: $root.nextSection">Begin test</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div data-bind="visible: section() == 1">
            <h3 data-bind="text: questionHeading()[$root.questionBank1.currentPage()-1]"></h3>
            <p>Please answer without referring to outside help.</p>
            <a href="#" style="display: none;" data-role="button" data-bind="old-visible: $root.questionBank1.currentPage() > 1, click: $root.questionBank1.movePrevious" data-inline="true"><i class="fa fa-angle-left 2x"></i></a>
            <ul style="margin:0px; padding-left: 0px; list-style: none;" data-bind="foreach: questionBank1.currentPageData">
              <li class="statement" data-bind="css: {completed: selected() !== 'Please select'}">
                <span data-bind="text: statement"></span> <i class="fa fa-certificate" style="color: red;" data-bind="visible: selected() == 'Please select'"></i>
                <br/>
                <select id="selector" data-inline="true" data-native-menu="true" data-bind="options: options, value: selected"></select>
              </li>
            </ul>
            <p data-bind="visible: !$root.questionBank1.pageCompleted();">You must answer all mandatory questions (<i class="fa fa-certificate" style="color: red;"></i>) before proceeding.</p>
            <div data-bind="visible: $root.questionBank1.pageCompleted() && $root.questionBank1.currentPage() <  $root.questionBank1.pageCount()">
              <p><b>Review your answers and press the green button to continue.</b>
              </p> <a href="#" class="positive" data-theme="b" data-role="button" data-icon="carat-r" data-iconpos="right" data-bind="click: $root.questionBank1.moveNext">Next page</a>
            </div> <a href="#" class="positive" data-theme="b" data-role="button" data-bind="visible: $root.questionBank1.pageCompleted() && $root.questionBank1.currentPage() ==  $root.questionBank1.pageCount(), click: $root.nextSection">Next section</a>
          </div>
          <div data-bind="visible: section() == 2" style="height: 150px;  background: white; box-shadow: 0px 0px 10px 10px #fff;">
            <p style="margin: 0px">Please take some time to explore the <span data-bind="visible: treatment() == 'app'">Special Blood Request app (below)</span><span data-bind="visible: treatment() == 'lothian'">current NHS Lothian hospital guidelines</span>. Press Done when you're ready.
            <a href="#" style="margin:0px" class="positive" data-theme="b" data-role="button" data-bind="click: $root.nextSection" data-inline="true">Done</a> </p>
          </div>
          <div data-bind="visible: section() == 3">
            <p class="smallquestion" data-bind="text: questionHeading2()[$root.questionBank2.currentPage()-1]"></p>
            <ul style="margin: 0px; padding-left: 0px; list-style: none;" data-bind="foreach: questionBank2.currentPageData">
              <li class="statement" data-bind="css: {completed: selected() !== 'Please select'}">
                <span data-bind="text: statement"></span> <i class="fa fa-certificate" style="color: red;" data-bind="visible: selected() == 'Please select'"></i>
                <br/>
                <select id="selector" data-inline="true" data-native-menu="true" data-bind="options: options, value: selected"></select> <a href="#" class="positive" data-theme="b" data-role="button" data-bind="visible: $root.questionBank2.pageCompleted() && $root.questionBank2.currentPage() <  $root.questionBank2.pageCount(), click: $root.questionBank2.moveNext" data-inline="true">Next</a>
                <a href="#" class="positive" data-theme="b" data-role="button" data-bind="visible: $root.questionBank2.pageCompleted() && $root.questionBank2.currentPage() == $root.questionBank2.pageCount(), click: $root.nextSection" data-inline="true">Next section</a>
              </li>
            </ul>
          </div>
        </div>
        <div data-bind="visible: section() > 0 && section() !== '2'" style="border: 0px solid #aaa; background: #EFE;">
          <p id="progressbar" data-bind="style: {width: progress() + 1 + '%'}, text: progress() + 1 + '% completed' "></p>
        </div>
        <div data-bind="visible: (section() == 2 || section() == 3) && treatment() == 'ggc'" id="ggc"> <i>Extract from NHS Greater Glasgow and Clyde Blood Transfusion Special Requirements Guideline (March 2013, issue 1), pages 1-8:</i>
          <div> <a href="#" style="position: absolute; margin-top:0px; right: 0px;" data-role="button" data-inline="true" data-bind="click: findall"><i class="fa fa-search"></i></a>
            <a href="#" style="position: absolute; margin-top:0px; left: 10px;" data-role="button" data-inline="true" data-bind="visible: searchterm(), click: clearsearch">x</a>
            <input class="searchbar" style="margin-left: 2em;" placeholder="Search guidelines" type="text" data-bind="value: searchterm, valueUpdate: 'keypress'">
          </div>
          <hr/>
          <h3><u>INTRODUCTION</u>
          </h3>
          <p>This guideline is for all staff involved in prescribing, supplying and administering blood and blood components throughout Greater Glasgow and Clyde Health Board (GG&amp;C). It should be used in conjunction with the GG&amp;C Clinical Transfusion Policy. The aim of the Clinical Transfusion policy is to ensure that the <b>right</b> blood is given to the <b>right</b> patient at the <b>right</b> time, <b>every</b> time. This policy focuses on those patients who have a special requirement for transfusion and it aims:</p>
          <ul>
            <li>To provide healthcare professionals with clear guidelines on when Cytomegalovirus (CMV) seronegative components, irradiated components, or other special requirements for transfusion are indicated</li>
            <li>To outline the process of notification to the hospital Blood Bank, of patients with special requirements</li>
            <li>To outline how this information will be disseminated across Greater Glasgow and Clyde</li>
            <li>To outline how errors should be reported if they arise.</li>
          </ul>
          <p>Advice on blood transfusion may be obtained from Biomedical Scientist (BMS) staff in Blood Bank, from Haematology Medical Staff and from hospital Transfusion Practitioners.</p> <b><i>[NB: Contact details not reproduced in this extract.]</i></b>
          <p>This policy has been prepared for the GG&amp;C Overarching Transfusion Committee and represents current standards. It will be reviewed every two years to accommodate future changes in the provision of health care in GG&amp;C and in the provision of blood and blood components.</p>
          <h3><u>REASON FOR SPECIAL REQUIREMENTS AND IDENTIFICATION OF PATIENTS</u>
          </h3>
          <ul>
            <li>Special requirements cover a range of additional specifications or processing of standard blood components</li>
          </ul>
          <p>The most commonly requested special requirements in practice are irradiated components and CMV seronegative components.</p>
          <h3>CMV Seronegative Components</h3>
          <p>Cytomegalovirus (CMV) belongs to the herpes family and in the healthy population causes a self limiting illness. It is cell associated and therefore can be transmitted in cellular blood components (red cells, platelets and granulocytes). Typically it causes a subclinical illness similar to infectious mononucleolus (glandular fever). In immunocompromised patients it can result in potentially fatal pneumonitis or disseminated CMV. For this reason CMV seronegative products should be used for a selected group of patients, listed below.</p>
          <p>The requirement for CMV seronegative blood components has been recently reviewed by the Advisory Committee on the Safety of Blood, Tissue and Organs (SaBTO). Universal leucodepletion, introduced by the UK blood services in 1999 primarily as a vCJD risk reduction measure, results in a three log depletion of white cells. This is generally accepted to render these components "CMV safe"</p>
          <p>Monitoring selected patient groups for CMV infection with pre-emptive therapy where required has been shown to be a successful strategy in certain groups (solid organ transplants, haematopoietic stem cell transplants).</p>
          <p>CMV seronegative components should continue to be used where leucodepletion is not possible (granulocyte transfusions) or where the potential severity of the consequences of CMV infection, and/or the difficulty in monitoring for infection are considered too great (IUT and transfusions in neonates up to 28 days post EDD, elective transfusions in pregnancy).
            <p>
              <p>Pregnant women who are being regularly transfused throughout their pregnancy should receive CMV seronegative components. There is no requirement for this for emergency transfusions in pregnancy.</p>
              <p>As CMV is a common virus and the prevalence of anti-CMV in the UK adult population is 50-60%, it not possible to provide CMV seronegative products for all recipients. Components that have been leucocyte depleted to less than 5 x 10^6/unit have a significant reduction in the risk of CMV transmission.</p> <i><b>[NB: IgA Deficiency section not reproduced in this extract.]</b></i>
              <h3>Irradiated Components</h3>
              <p>Irradiation is the only known method of preventing Transfusion Associated Graft versus Host Disease (TaGvHD). This is a rare but fatal complication of blood transfusion. It results from engraftment and clonal expansion of HLA compatible donor lymphocytes. Clinically TaGvHD presents with fever, rash, diarrhoea, hepatitis and pancytopenia 4-30 days after transfusion. This complication of transfusion is eliminated by inactivation of donor lymphocytes by irradiation. The risk associated with individual transfusions depends on the number and viability of contaminating lymphocytes, susceptibility of the host's immune system to their engraftment and the degree of immunological disparity between donor and recipient. <sup><a href="#ref2">2</a>,<a href="#ref3">3</a></sup>
              </p>
              <p>The table below identifies the patients who have requirements for irradiated and / or CMV seronegative components and the length of time these are required.</p>
              <table id="ggcindications" data-role="table">
                <thead>
                  <tr>
                    <th>Condition:</th>
                    <th>Cytomegalovirus CMV Seronegative:</th>
                    <th>Irradiated:</th>
                  </tr>
                </thead>
                <tr>
                  <td>Neonates up to 28 days post EDD</td>
                  <td>&#10003;</td>
                  <td>*</td>
                </tr>
                <tr>
                  <td>Intrauterine Transfusion (IUT)</td>
                  <td>&#10003;</td>
                  <td>&#10003;**</td>
                </tr>
                <tr>
                  <td>Neonatal Exchange Transfusion (ET)</td>
                  <td>&#10003;</td>
                  <td>***</td>
                </tr>
                <tr>
                  <td>All donations from first or second degree relative</td>
                  <td></td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>Severe T lymphocyte immunodeficiency syndromes including Di George and Severe Combined Immunodeficiency</td>
                  <td>&#10003;</td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>Recipients of haemopoietic stem cell transplantation (HSCT)</td>
                  <td></td>
                  <td>&#10003;%Q</td>
                </tr>
                <tr>
                  <td>Stem cell harvesting
                    <br><i> from mobilisation or 2 weeks before the harvest (whichever is earliest) until harvest is completed</i>
                  </td>
                  <td></td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>All recipients of alemtuzumab (Campath, anti CD-52)</td>
                  <td></td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>All patients with Hodgkins lymphoma</td>
                  <td></td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>All patients treated with purine analogues, e.g. fludarabine, cladrabine, deoxycoformicin, clofarabine</td>
                  <td></td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>All patients with aplastic anaemia treated with immunosuppressive therapy (until lymphocyte count >1.0 x10^9/L)</td>
                  <td></td>
                  <td>&#10003;</td>
                </tr>
                <tr>
                  <td>Pregnant women on regular transfusion programme</td>
                  <td>&#10003;</td>
                  <td></td>
                </tr>
              </table>
              <p><b>Leucodepleted CMV seropositive components (CMV safe) may be used for the above patient groups 
            in the situation of life-threatening haemorrhage</b>
              </p>
              <p><b>CMV seronegative components should only be used for CMV negative patients or those in whom CMV status is unknown.</b>
              </p>
              <p>* Top up transfusions in infants aged &lt;6 months do not require irradiation unless there has been a previous IUT or if the donation is from a first or second-degree relative</p>
              <p>** The requirement for irradiation after IUT remains until 6 months after 40 weeks gestation</p>
              <p>*** Products for neonatal ET must be irradiated when there has been a previous IUT or if the donation is from a first or second-degree relative.
                <br/>For other neonatal ET, irradiation is recommended if irradiation will not delay transfusion</p>
              <p>Whilst a diagnosis of severe T lymphocyte immunodeficiency is considered all components transfused should be irradiated and CMV seronegative whilst further tests are being undertaken</p>
              <p>?Q more detailed requirements for transplant recipients are as follows:</p>
              <div style="margin-left:25px"> <b><i>allografts</i></b> - irradiated components should be given indefinitely
                <br/> <b><i>autografts</i></b> - irradiated components should be given until 6 months post transplant</div>
              <p><b><i>[NB: Plasma reduced components section not reproduced in this extract.]</i></b>
              </p>
              <p><b>If there is any doubt as to whether or not a patient has a requirement for 
          special blood components please discuss with the on call Haematologist at your local site.</b>
              </p>
              <h3><u>NOTIFICATION TO THE LABORATORY OF PATIENTS WITH SPECIAL REQUIREMENTS</u>
              </h3>
              <p>Once a patient has been identified as having a requirement for special blood components, a standard form, used throughout GG&amp;C (see appendix 1 <b><i>[NB: request form not reproduced in this extract]</i></b>), should be fully completed and sent to the local Blood Bank. The information held on this form will be shared with all Blood Banks throughout GG&amp;C.</p>
              <p>The form should be signed by the Consultant in charge of the patient's care. It should be photocopied and a copy filed in the case records with the second copy forwarded to Blood Bank. If the patient has been identified as having special blood component requirements out with core working hours and a Consultant is not available, the requirement can be requested on a regular transfusion form and the special requirements form forwarded at the earliest possible opportunity. The information will not be disseminated throughout the Health Board Blood Banks until a Consultant signed copy of the special requirements form is received by the hospital Blood Bank.</p>
              <p>If the need for the special blood components changes, an updated form should be forwarded to the hospital Blood Bank so their records can be amended.</p>
              <h3>Laboratory Dissemination of Information</h3>
              <p>As patients regularly transfer between hospital sites it is important that their transfusion requirement information is available throughout the Health Board Blood Banks. Once a Consultant signed form is received at a local Blood Bank, the form will be scanned and emailed to the Blood Bank managers in the South, North, Clyde and the Golden Jubilee Hospital so that their computer systems can be updated accordingly (as per the Blood Bank special requirements SOP).</p>
              <p>The form will be returned to the requesting Consultant to ensure they are aware the laboratory tasks have been completed.</p>
              <h3><u>PATIENT COUNSELLING AND CONSENT</u>
              </h3>
              <p>It is not a legal requirement in the United Kingdom that written consent is obtained before a transfusion of blood components; however, it is considered a required standard of good transfusion practice to ensure that the patient/parent/carer receives adequate information regarding the transfusion. This standard is laid down in the NHS QIS Clinical Standards (2006) now known as Healthcare Improvement Scotland and compliance is monitored. <sup><a href="#ref4">4</a></sup> This discussion should include information about the risks and benefits of transfusion as well as information relating to available alternatives, for example, iron supplementation and must be documented in the case records. Nursing and medical staff therefore, have a professional duty to ensure that they have adequate knowledge of transfusion related issues or that they can access the information and support required by patients undergoing a transfusion.</p>
              <p>Booklets are available specifically for patients who require irradiated components and all patients receiving irradiated components should be given these before their first transfusion. They should also be counselled and told to inform nursing and medical staff of this requirement before any future transfusions. Patients should be given a card to carry documenting their special transfusion requirement. An adhesive sticker, taken from the information leaflet, should be placed on the front of case records detailing the requirement. It is the responsibility of the prescribing practitioner to ensure these steps are undertaken.</p>
              <h3>INCIDENT REPORTING</h3>
              <p>There have been 13 reported cases of TaGVHD since 1996 but no cases in the last 8 years. 2 cases have been reported in leucodepleted components (1998-99 and 2000-01) indicating that while leucodepletion significantly reduces, it does not eradicate the risk of this condition. It is important therefore that appropriate products are provided for patients at risk.</p>
              <p>Errors do occur and the Serous Hazards of Transfusion (SHOT) report 2010 documents 74 cases where special requirements were not met. The majority of these (59 cases) were patients who required irradiated products but did not receive them. <sup><a href="#ref5">5</a></sup> It is important that any errors are documented appropriately to ensure that steps can be taken to avoid them in the future. If it becomes apparent that a patient has failed to receive appropriate components the hospital Blood Bank must be informed immediately. The incident will be fully investigated and reported on DATIX and to SHOT.</p>
              <h3><u>REFERENCES</u>
              </h3>
              <ol>
                <li>Transfusion Transmitted Infection. Chapter 13. Practical Transfusion Medicine. Third Edition. P122-145. Murphy MF, Pamphilon DH.</li>
                <li>
                  <a id="ref2"></a>Clinical Blood Transfusion. Chapter 16 Postgraduate Haematology Sixth Edition. P268-300. Hoffbrand AV, Catovsky D, Tuddenham EDD, Green AR.</li>
                <li>
                  <a id="ref3"></a>Guidelines on the use of irradiated blood components prepared by the British Committee for Standards in Haematology blood transfusion task force British Journal of Haematology 2011, 152, 35-51</li>
                <li>NHS QIS Clinical Standards - Blood Transfusion <a href="http://www.healthcareimprovementscotland.org/previous_resources/standards/clinical_standards_-_blood_tra.aspx" target="_blank">http://www.healthcareimprovementscotland.org/previous_resources/standards/clinical_standards_-_blood_tra.aspx</a>
                </li>
                <li>Serious Hazards of Transfusion <a href="http://www.shotuk.org" target="_blank">http://www.shotuk.org/</a>
                </li>
                <li>Transfusion guidelines for neonates and older children British Journal of Haematology 2004, 124, 433 - 453</li>
                <li>Advisory Committee on the Safety of Blood, Tissues and Organs (SaBTO) <a href="http://www.dh.gov.uk/prod_consum_dh/groups/dh_digitalassets/@dh/@en/documents/digitalasset/dh_133086.pdf" target="_blank">http://www.dh.gov.uk/prod_consum_dh/groups/dh_digitalassets/@dh/@en/documents/digitalasset/dh_133086.pdf</a>
                </li>
              </ol>
        </div>
        <div data-bind="visible: (section() == 2 || section() == 3) && treatment() == 'lothian'" id="lothian"> <i>Extract from NHS Lothian, Blood Transfusion Clinical Policy and Procedures 2013 (v.4), Appendic C: Special Requirements, pages 45-46:</i>
          <h3>Irradiated Components</h3>
          <p>For at-risk patients, all red cell, platelet and granulocyte concentrates should be irradiated. It is not necessary to irradiate FFP, cryoprecipitate or fractionated plasma products.</p>
          <ul>
            <li>All intrauterine transfusions.</li>
            <li>All exchange or top-up transfusions in infants where there has been a previous intra-uterine transfusion, until 6 months after the expected delivery date.</li>
            <li>Exchange transfusion, with no previous intra-uterine transfusion; irradiated blood is recommended provided this does not unduly delay transfusion.</li>
            <li>Proven or suspected congenital immunodeficiency states (including Severe Combined Immunodeficiency (SCID), Di George's syndrome, Wiskott-Aldrich syndrome, purine nucleoside phosphorylase deficiency, reticular dysgenesis, cell- mediated immunodeficiency (not otherwise classified), primary T lymphocyte immunodeficiencies, adenosine deaminase deficiency, MHC Class I and II deficiency, leucocyte adhesion deficiency, immunodeficiency with eosinophilia, ataxia telangiectasia, chronic mucocutaneous candidiasis).</li>
            <li>All autologous bone marrow or peripheral blood stem cell transplant recipients from start of conditioning until at least three months after transplant (or until at least six months after transplant if total body irradiation has been given).</li>
            <li>All allogeneic bone marrow or peripheral blood stem cell transplant recipients from start of conditioning until a minimum of six months after transplant; possibly longer at the discretion of the haematologist e.g. chronic GvHD.</li>
            <li>Blood transfused to allogeneic bone marrow or peripheral blood stem-cell donors for 7 days before the harvest and until after the last collection.</li>
            <li>Blood transfused to patients undergoing autologous bone marrow harvest for the 7 days before the harvest and until after the harvest.</li>
            <li>Blood transfused to patients undergoing autologous peripheral blood stem-cell mobilisation from commencement of the mobilising chemotherapy regimen and until the last collection.</li>
            <li>Patients with Hodgkin's disease, indefinitely.</li>
            <li>Patients treated with the purine analogue drugs Fludarabine, Deoxycoformycin, Cladribine, Clofarabine and Bendamustine, indefinitely.</li>
            <li>All transfusions from first- or second-degree relatives, even if the patient is immunocompetent.</li>
            <li>All HLA-matched platelet transfusions, even if the patient is immunocompetent.</li>
            <li>All granulocyte transfusions, which must then be transfused with minimum delay.</li>
            <li>Patients receiving ALG, ATG, CAMPATH or any other T-cell depleting agents (such as alemtuzumab for non-haematological indications including solid organ transplantation, multiple sclerosis and vasculitis) during treatment and then indefinitely.</li>
          </ul>
          <h3>CMV Negative Components</h3>
          <ul>
            <li>Intra-uterine transfusion irrespective of the CMV status of the mother.</li>
            <li>Pregnant women antenatally (pre-delivery only). If CMV negative components are not readily available and a delay will compromise the mother or baby, CMV random components (i.e. untested) are an acceptable alternative.</li>
            <li>All blood transfusions for infants up to 28 days post expected delivery date.</li>
          </ul>
        </div>
        <div data-bind="visible: section() == 4">
          <h1>Usability evaluation</h1>
          <p>Thinking about the app, please answer the following questions as best you can.</p>
          <h3>I thought there was too much inconsistency in this system.</h3>
          <select data-bind="value: sus1">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I would imagine that most people would learn to use this system very quickly.</h3>
          <select data-bind="value: sus2">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I found the system very cumbersome to use.</h3>
          <select data-bind="value: sus3">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I felt very confident using the system.</h3>
          <select data-bind="value: sus4">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I needed to learn a lot of things before I could get going with this system.</h3>
          <select data-bind="value: sus5">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I think that I would like to use this system frequently.</h3>
          <select data-bind="value: sus6">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I found the system unnecessarily complex.</h3>
          <select data-bind="value: sus7">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I thought the system was easy to use.</h3>
          <select data-bind="value: sus8">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I think that I would need the support of a technical person to be able to use this system.</h3>
          <select data-bind="value: sus9">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <h3>I found the various functions in this system were well integrated.</h3>
          <select data-bind="value: sus10">
            <option value="" selected>Please select</option>
            <option value="1">Strongly disagree</option>
            <option value="2">Disagree</option>
            <option value="3">Neither agree nor disagree</option>
            <option value="4">Agree</option>
            <option value="5">Strongly agree</option>
          </select>
          <div data-bind="visible: (sus1() && sus2() && sus3() && sus4() && sus5() && sus6() && sus7() && sus8() && sus9() && sus10())">
            <p><b>Press the green button to submit</b>.</p> <a href="#" class="positive" data-role="button" data-bind="click: $root.nextSection">Submit</a>
          </div>
        </div>
      </div>
      <div id="appcontainer" data-bind="html: appCode"></div>
      <select data-role='none' data-bind="value: $root.section" style="position: fixed; top:0px; right: 0px">
        <option value="-1">-1</option>
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
      </select>
    </div>
    <script type='text/javascript'>
      // http://jsfiddle.net/zeelux/B4vN2/
      (function() {
        'use strict';
        ko.extenders.paging = function(target, pageSize) {
          var _pageSize = ko.observable(pageSize || 10),
            // default pageSize to 10
            _currentPage = ko.observable(1); // default current page to 1
          target.pageSize = ko.computed({
            read: _pageSize,
            write: function(newValue) {
              if (newValue > 0) {
                _pageSize(newValue);
              } else {
                _pageSize(10);
              }
            }
          });
          target.currentPage = ko.computed({
            read: _currentPage,
            write: function(newValue) {
              if (newValue > target.pageCount()) {
                _currentPage(target.pageCount());
              } else if (newValue <= 0) {
                _currentPage(1);
              } else {
                _currentPage(newValue);
              }
              $("#selector").selectmenu();
              $(window).scrollTop(0);
              $("#questionContainer").trigger("create");
            }
          });
          target.pageCount = ko.computed(function() {
            return Math.ceil(target().length / target.pageSize()) || 1;
          });
          target.currentPageData = ko.computed(function() {
            var pageSize = _pageSize(),
              pageIndex = _currentPage(),
              startIndex = pageSize * (pageIndex - 1),
              endIndex = pageSize * pageIndex;
            return target().slice(startIndex, endIndex);
          });
          target.moveFirst = function() {
            target.currentPage(1);
          };
          target.movePrevious = function() {
            target.currentPage(target.currentPage() - 1);
          };
          target.moveNext = function() {
            target.currentPage(target.currentPage() + 1);
          };
          target.moveLast = function() {
            target.currentPage(target.pageCount());
          };
          return target;
        };
      }());
      ko.bindingHandlers.jqmEnhance = {
        update: function(element, valueAccessor) {
          // Get jQuery Mobile to enhance elements within this element
          $(element).trigger("create");
        }
      };

      function getUrlParameter(sParam) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) {
          var sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] == sParam) {
            return sParameterName[1];
          }
        }
      }
       // Randomise array ordering
      Array.prototype.shuffle = function() {
        var i = this.length,
          j, temp;
        if (i == 0) return this;
        while (--i) {
          j = Math.floor(Math.random() * (i + 1));
          temp = this[i];
          this[i] = this[j];
          this[j] = temp;
        }
        return this;
      }
      var questions = {
        theme1: [{
          statement: "Removal of leucocytes from platelets and red cells reduces risk of CMV transmission.",
          rationale: "Guage understanding of the main cause of transfusion associated CMV transmission.",
          explanation: "Platelets and red cell components contain leucocytes (white blood cells). Transfusion associated cytomegalovirus (CMV) infection is transmitted through transfusion of CMV-infected donor monocytes (SaBTO 2012). Monocytes are large, phagocytic mononuclear leukocytes (MESH 2014). Universal leucodepletion, typically achieved through filtration, is effective in removing monocytes and significantly reduces the risk of CMV transmission during red cell and platelet transfusion.",
          key: "True",
          options: ["Please select", "True", "False", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Only red cells and platelets for patients with special requirements is leucodepleted in the UK.",
          rationale: "Check awareness of universal leucodepletion, a pre-storage processing step enhancing component safety.",
          explanation: "Universal leucodepletion, the removal of leucocytes (white blood cells) through filtration from all platelets and red cells components manufactured in the UK irrespective of recipient, was introduced in 1998 and remains in place.",
          key: "False",
          options: ["Please select", "True", "False", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Leucodepletion is as effective as irradiation in the prevention of TA-GvHD.",
          rationale: "Test beliefs about leucodepletion and adherence to BCSH guidelines on irradiated blood.",
          explanation: "Even though leucodepletion is likely to reduce the risk of Transfusion Associated Graft versus Host Disease (TA-GvHD), the evidence is incomplete and it is not an accepted alternative. Current national guidelines (BCSH 2010) recommend irradiation to prevent TA-GvHD.",
          key: "False",
          options: ["Please select", "True", "False", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Red cells, platelets and granulocytes are cellular blood components.",
          rationale: "Guage understanding of the distinction between non-/cellular components as it is frequently used in guidelines",
          explanation: "Cellular blood components refer to platelet, red cell and granulocyte (white cell) components. Cellular blood components contain leucocytes that can cause TA-GvHD or transmit CMV infection.",
          options: ["Please select", "True", "False", "Don't know"],
          key: "True",
          selected: ko.observable("Please select")
        }, {
          statement: "Transfusion of cellular blood components can cause TA-GvHD and CMV infection.",
          rationale: "Test knowledge that cellular blood components, and specifically the white blood cells they contain, can cause these conditions.",
          explanation: "A requirement for TA-GvHD is the transfusion of viable donor T-lymphocytes (a type of white blood cell). CMV infection is transmitted by transfusion of infected donor monocytes (another type of white blood cell). Cellular blood components contain leucocytes (white blood cells, including T-lymphocytes and monocytes), and can therefore cause both TA-GvHD and CMV infection.",
          key: "True",
          options: ["Please select", "True", "False", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "All cellular blood components are routinely irradiated in the UK.",
          rationale: "Test knowledge of current UK blood irradiation practice.",
          explanation: "Cellular blood components are not routinely irradiated in UK. This is why irradiation must to be specifically entered under special requirements on the blood request form.",
          key: "True",
          options: ["Please select", "True", "False", "Don't know"],
          selected: ko.observable("Please select")
        }],
        theme2: [{
          statement: "Viable donor lymphocytes in component.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Recipient with low haemoglobin level.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Shared HLA haplotype between donor and recipient",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Age of blood component.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Recipient with HIV/AIDS.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Granulocyte component.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Fresh Frozen Plasma (FFP).",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Recipient with severe T-lymphocyte immunodeficiency.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }],
        theme3: [{
          statement: "Lack of knowledge of the indications for special components.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Failure to request blood according to local guidelines.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Poor communication between clinicians during shared patient care.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Radiation effects after transfusion of irradiated blood.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Mistaken patient identity at component collection and transfusion.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Transfusion of incorrectly stored components.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Erroneous data in laboratory information systems.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Unnecessary requests for special blood components.",
          options: ["Please select", "Yes", "No", "Don't know"],
          selected: ko.observable("Please select")
        }],
        theme4: [{
          statement: "Red cells known to be from a second degree relative of the patient.",
          options: ["Please select", "Irradiated & CMV-neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Red cells for patients on Fludarabine or Alemtuzmab (Campath).",
          options: ["Please select", "Irradiated & CMV-neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Elective red cell transfusion for a pregnant woman in second trimester.",
          options: ["Please select", "Irradiated & CMV-neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Fresh frozen plasma for a patient with Hodgkin's lymphoma.",
          options: ["Please select", "Irradiated & CMV-neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "HLA-matched platelets for a patient with refractoriness.",
          options: ["Please select", "Irradiated & CMV-neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Red cells for an infant who had an intrauterine transfusion (IUT) a year ago.",
          options: ["Please select", "Irradiated & CMV-neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Red cells for a patient receiving bone marrow transplant in the last 3 months.",
          options: ["Please select", "Irradiated & CMV neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }, {
          statement: "Platelets for a non-emergency bleeding cancer patient on purine analogues.",
          options: ["Please select", "Irradiated & CMV neg.", "Irradiated", "CMV-negative", "No special component", "Don't know"],
          selected: ko.observable("Please select")
        }]
      };
       // Randomly allocate questions into two groups
      questions.theme1.shuffle();
      questions.theme2.shuffle();
      questions.theme3.shuffle();
      questions.theme4.shuffle();
       // highlight text
      jQuery.fn.highlight = function(str, className) {
        var regex = new RegExp(str, "gi");
        return this.each(function() {
          $(this).contents().filter(function() {
            return this.nodeType == 3;
          }).replaceWith(function() {
            return (this.nodeValue || "").replace(regex, function(match) {
              return "<span class=\"" + className + "\">" + match + "</span>";
            });
          });
        });
      };
      var ViewModel = function() {
        var self = this;
        self.section = ko.observable(getUrlParameter('section') || -1);
        self.hospital = ko.observable("");
        self.position = ko.observable("");
        self.otherposition = ko.observable("");
        self.grade = ko.observable("");
        self.specialty = ko.observable("");
        self.otherspecialty = ko.observable("");
        self.experience = ko.observable("");
        self.currentwork = ko.observable("");
        self.currentexperience = ko.observable("");
        self.pastwork = ko.observable("");
        self.pastexperience = ko.observable("");
        self.frequency = ko.observable("");
        self.sus1 = ko.observable("");
        self.sus2 = ko.observable("");
        self.sus3 = ko.observable("");
        self.sus4 = ko.observable("");
        self.sus5 = ko.observable("");
        self.sus6 = ko.observable("");
        self.sus7 = ko.observable("");
        self.sus8 = ko.observable("");
        self.sus9 = ko.observable("");
        self.sus10 = ko.observable("");
        self.treatment = ko.observable(getUrlParameter('treatment') || "app");
        self.questionHeading = ko.observableArray(["1. Is the statement true or false?", "2. What are risk factors for TA-GvHD?", "3. What are common errors involving special components?", "4. What is the correct blood component specification?"]);
        self.questionHeading2 = ko.observableArray(["5a. Is the statement true or false?", "5b. Is the statement true or false?", "5c. Is the statement true or false?", "6a. What are risk factors for TA-GvHD?", "6b. What are risk factors for TA-GvHD?", "6c. What are risk factors for TA-GvHD?", "7a. What are common errors involving special components?", "7b. What are common errors involving special components?", "7c. What are common errors involving special components?", "8a. What is the correct blood component specification?", "8b. What is the correct blood component specification?", "8c. What is the correct blood component specification?"]);
        self.questionBank1 = ko.observableArray(questions.theme1.splice(0, 3).concat(questions.theme2.splice(0, 3)).concat(questions.theme3.splice(0, 3)).concat(questions.theme4.splice(0, 3))).extend({
          paging: 3
        });
        self.questionBank2 = ko.observableArray(questions.theme1.splice(0, 3).concat(questions.theme2.splice(0, 3)).concat(questions.theme3.splice(0, 3)).concat(questions.theme4.splice(0, 3))).extend({
          paging: 1
        });
        self.progress = ko.computed(function() {
          var count = 0;
          for (i = 0; i < self.questionBank1.pageCount() * self.questionBank1.pageSize(); i++) {
            if (self.questionBank1()[i].selected() !== 'Please select') count++;
          }
          for (i = 0; i < self.questionBank2.pageCount() * self.questionBank2.pageSize(); i++) {
            if (self.questionBank2()[i].selected() !== 'Please select') count++;
          }
          return Math.round(100 / ((self.questionBank1.pageCount() * self.questionBank1.pageSize()) + (self.questionBank2.pageCount() * self.questionBank2.pageSize())) * count);
        });
        self.questionBank1.pageCompleted = ko.computed(function() {
          var passed = true;
          for (i = (self.questionBank1.currentPage() - 1) * self.questionBank1.pageSize(); i < self.questionBank1.currentPage() * self.questionBank1.pageSize(); i++) {
            if (self.questionBank1()[i].selected() == 'Please select') passed = false;
          }
          return passed;
        });
        self.questionBank2.pageCompleted = ko.computed(function() {
          var passed = true;
          for (i = (self.questionBank2.currentPage() - 1) * self.questionBank2.pageSize(); i < self.questionBank2.currentPage() * self.questionBank2.pageSize(); i++) {
            if (self.questionBank2()[i].selected() == 'Please select') passed = false;
          }
          return passed;
        });
        self.appCode = ko.computed(function() {
            var iframeheight = $( window ).height() - $("#maincontainer").outerHeight() - 10;
            var code = '<iframe src="http://optimalblooduse.eu/app/" width="100%" height="' + iframeheight + 'px"></iframe>';
            if ((self.section() == 2 || self.section() == 3) && self.treatment() == 'app') return code;
            else return;
        }, this, { deferEvaluation: true });
        
        self.nextSection = function() {
          self.section(self.section() + 1);
          $(window).scrollTop(0);
        }
        self.clearsearch = function() {
          $(".highlight").replaceWith(function() {
            return $(this).contents();
          });
          self.searchterm('');
        };
        self.searchterm = ko.observable('');
        self.findall = function() {
          var term = self.searchterm();
          // Clear existing highlights
          $(".highlight").replaceWith(function() {
            return $(this).contents();
          });
          // New search
          if (term.length > 1) {
            $("#ggc *").highlight(term, "highlight");
            var occurrances = $(".highlight") ? $(".highlight").length : 0;
            if (occurrances < 1) {
              alert("Search term not found");
              return;
            } else {
              $(window).scrollTop($(".highlight:first").offset().top - 150);
            }
            alert("Found " + occurrances + " occurrances of search term.");
          } else {
            alert("Search term must be two characters or more");
          }
        };
      };
      var model = new ViewModel();
      ko.applyBindings(model);
      $(".searchbar").on('keypress', function(e) {
        if (e.keyCode == 13) {
          model.findall();
        }
      });
    </script>
  </body>

</html>