<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>eresept Sykehusapotekene Sør øst</title>
    <script type='text/javascript' src='//code.jquery.com/jquery-1.9.1.js'></script>
    <script type='text/javascript' src="http://knockoutjs.com/downloads/knockout-3.0.0.js"></script>
    <script type='text/javascript' src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
  </head>

  <body>
    <div data-role="page" id="front">
      <div data-role="header"> <a href="#next" data-role="button">Om oss</a>
        <h3>NB! TEST SIDE KUN!</h3>
        <h3>Sykehusapotekene HF </h3>
      </div>
      <div data-role="main" class="ui-content">
        <h3>Hvor vil du hente ut din eresept?</h3>
        <div class="ui-field-contain">
          <label for="apotek">Velg apotek:</label>
          <select id="apotek" data-bind="value: apotek">
            <option>Arendal</option>
            <option>Bærum</option>
            <option>Drammen</option>
            <option>Elverum</option>
            <option>Fredrikstad</option>
            <option>Gjøvik</option>
            <option>Hamar</option>
            <option>Kongsvinger</option>
            <option>Kristiansand</option>
            <option>Lillehammer</option>
            <option>Lørenskog</option>
            <option>Moss</option>
            <option>Radiumhospitalet</option>
            <option>Rikshospitalet</option>
            <option>Skien</option>
            <option>Tønsberg</option>
            <option>Ullevål</option>
          </select>
        </div>
        <div class="ui-field-contain">
          <label for="personnummer">Ditt fødselsnummer:</label>
          <input id="personnummer" data-bind="value: personnr" />
        </div>
        <div class="ui-field-contain">
          <label for="navn">Hele ditt navn:</label>
          <input id="navn" data-bind='value: navn' />
        </div>
        <div class="ui-field-contain">
          <label for="medisin">Medisin om kjent:</label>
          <textarea id="medisin" data-bind="value: medisin"></textarea>
        </div>
         <div class="ui-field-contain">
          <label for="telefon">Ditt telefonnummer:</label>
          <input id="telefon" data-bind="value: telefon" />
        </div>
         <div class="ui-field-contain">
          <label for="epost">Din e-postadresse:</label>
          <input id="epost" data-bind="value: epost" />
        </div>
        <hr/>
       <a href="#" onclick="javascript: sendData();" data-role="button">Send inn din bestilling</a>
      </div>
    </div>
    <div data-role="page" id="next">
      <div data-role="header"> <a href="#front" data-role="button">Front</a>
        <h3>Next</h3>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[ 
      /* custom binding handler thanks to Varun http://stackoverflow.com/a/16493161/2308978 */
      ko.bindingHandlers.slider = {
        init: function(element, valueAccessor) {
          console.log("init");
          // use setTimeout with 0 to run this after Knockout is done
          setTimeout(function() {
            // $(element) doesn't work as that has been removed from the DOM
            var curSlider = $('#' + element.id);
            // helper function that updates the slider and refreshes the thumb location
            function setSliderValue(newValue) {
              curSlider.val(newValue).slider('refresh');
            }
            // subscribe to the bound observable and update the slider when it changes
            valueAccessor().subscribe(setSliderValue);
            // set up the initial value, which of course is NOT stored in curSlider, but the original element :\
            setSliderValue($(element).val());
            // subscribe to the slider's change event and update the bound observable
            curSlider.bind('change', function() {
              valueAccessor()(curSlider.val());
            });
          }, 250);
        }
      };
      var viewModel = {
        personnr: ko.observable(""),
        navn: ko.observable(""),
        medisin: ko.observable(""),
        apotek: ko.observable(""),
        telefon: ko.observable(""),
        epost: ko.observable("")
      };
      ko.applyBindings(viewModel);

      function sendData() {
        $.ajax({
          type: 'POST',
          url: "http://it4se.com:1337/prescription/",
          data: viewModel,
          xhrFields: {
            withCredentials: true
          }
        }).done(function(msg) {
          console.log("message: ", msg);
        });
      }
    </script>
  </body>

</html>